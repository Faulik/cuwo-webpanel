$(document).ready(function(){function e(e,t){c[t]={},c[t].name=e.name,c[t].level=e.level,c[t]["class"]=e["class"];var a=o[e["class"]-1][e.specialization];c[t].specialization=a,c[t].health=health_calk(e["class"],a,e.level),$("table.players tbody").append("<tr data-id="+t+"><td class='id'>"+t+"</td>"+"<td class='name'>"+e.name+"</td>"+'<td class="level">'+e.level+"</td>"+'<td class="class">'+i[e["class"]]+"</td>"+'<td class="specialization">'+a+"</td></tr>")}function t(e){delete c[e],$("tr[data-id="+e+"]").remove(),$("tr.player_controls").remove()}function a(e,t){c[t].name=e.name,c[t].level=e.level,c[t]["class"]=e["class"];var a=o[e["class"]][e.specialization];c[t].specialization=a,c[t].health=health_calk(e["class"],a,e.level),$("tr[data-id="+t+"] td.name").text(e.name),$("tr[data-id="+t+"] td.level").text(e.level),$("tr[data-id="+t+"] td.class").text(i[e["class"]]),$("tr[data-id="+t+"] td.specialization").text(a)}function s(e){var t=c[e].name;$("#serverPlayers").append('<p data-id="'+e+'">id#'+e+" "+t+"</p>")}function n(e){$('#serverPlayers p[data-id="'+e+'"]').remove()}function r(e,t){var a;a=0==t?"Server":c[t].name,$("#chatMessages").append('<p data-id="'+t+'"><span>'+a+"</span>: "+e+"</p>"),$("#chatMessages").scrollTop($("#chatMessages")[0].scrollHeight),$("#chatMessages > p").length>200&&$("#chatMessages").children(":first").remove()}function l(){function i(){if(0==$(this).hasClass("chosen_player")){var e=$(this).parent();e.find("tr.chosen_player").next().remove(),e.find("tr.chosen_player").children(":first").removeAttr("rowspan"),e.find("tr.chosen_player").removeClass("chosen_player"),$(this).addClass("chosen_player"),$(":first-child",this).attr("rowspan",2),$(this).after('<tr class="player_controls"><td colspan="4"><button type="button" value="kick" class="btn" >Kick</button><button type="button" value="ban" class="btn" >Ban</button><input type="text" value="" placeholder="Reason" class="text"></td></tr>')}$("table.players tbody tr.player_controls td button").off("click").on("click",function(){p.send(JSON.stringify({request:$(this).val(),data:{player:"#"+$(this).parent().parent().prev().attr("data-id"),reason:$(this).parent().find("input.text").val()}}))})}function o(e){p.send(JSON.stringify({request:"send-message",message:"Server: "+e}))}var p=new WebSocket("ws://"+window.location.hostname+":"+server_port);p.onopen=function(){$("span.reconnecting").text(""),clearInterval(d),p.send(auth_key),setTimeout(function(){p.send(JSON.stringify({request:"get-players"})),p.send(JSON.stringify({request:"subscribe",data:["on-join","on-leave","on-chat"]}))},1e3),p.onmessage=function(l){var i=JSON.parse(l.data);if("get-players"==i.request&&"success"==i.response){for(var o=i.data,d=Object.keys(o),p=0;p<Object.keys(o).length;p++)if("undefined"!=o[d[p]].name){var v=Object.keys(c).indexOf(d[p]);-1==v?(e(o[d[p]],d[p]),s(d[p])):a(o[d[p]],d[p])}if(d=Object.keys(c),0!=Object.keys(c).length)for(var p=0;p<Object.keys(c).length;p++){var v=Object.keys(o).indexOf(Object.keys(c)[p]);-1==v&&(n(d[p]),t(d[p]))}}else if("chat"==i.request){var u=i["player-id"];c[u].name;var h=i.message;r(h,u)}else if("on-join"==i.request){var o=i.data,u=o["entity-id"];-1==Object.keys(c).indexOf(u)?e(o,u):a(o,u)}},$("table.players").hover(function(){$("table.players tbody tr").click(i)},function(){var e=$("table.players tbody tr.chosen_player");e.removeClass("chosen_player"),e.children(":first").removeAttr("rowspan"),e.next().remove()}),$("#chatInput").off("keypress").on("keypress",function(e){return 13==e.which?(r($(this).val(),0),o($(this).val()),$(this).val(""),!1):void 0}),p.onclose=function(){$("span.reconnecting").text("Reconnecting"),d=setInterval(function(){l()},5e3)},window.onunload=function(){p.close()}}}var i={1:"Warrior",2:"Ranger",3:"Mage",4:"Rogue"},c={},o=[["Berserker","Guardian"],["Sniper","Scout"],["Fire","Water"],["Assassin","Ninja"]],d=null;$("ul.nav li").off("click").on("click",function(){var e=$(this).attr("data-name");$("ul.nav > li.current_tab").removeClass("current_tab"),$(this).addClass("current_tab"),$(".content_container > div:not(.hidden_tab)").addClass("hidden_tab"),$(".content_container > div#"+e).removeClass("hidden_tab")}),l()});